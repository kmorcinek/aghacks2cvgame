<!doctype html>
<meta charset="utf-8">
<title>Moving sprites</title>
<body>
    <script src="collision-detection.js"></script>
    <script src="pixi.js"></script>
    <script>

        //Aliases
        var Container = PIXI.Container,
            autoDetectRenderer = PIXI.autoDetectRenderer,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            TextureCache = PIXI.utils.TextureCache,
            Texture = PIXI.Texture,
            Sprite = PIXI.Sprite;

        //Create a Pixi stage and renderer and add the
        //renderer.view to the DOM
        var size = 256 * 2;
        var stage = new Container(),
            renderer = autoDetectRenderer(size, size);
        document.body.appendChild(renderer.view);

        loader
          .add("images/cat.png")
          .add("images/door.png")
          .add("images/wolf.png")
          .load(setup);

        //Define any variables that are used in more than one function
        var cat;
        var door;
        var obstacle;

        function setup() {

            //Create the `cat` sprite
            cat = new Sprite(resources["images/cat.png"].texture);
            cat.x = 96;
            cat.y = 66;
            cat.vx = 3;
            cat.vy = 5;

            stage.addChild(cat);

            door = new Sprite(resources["images/door.png"].texture);
            door.y = size - 50;
            door.x = size - 50;
            stage.addChild(door);

            obstacle = new Sprite(resources["images/wolf.png"].texture);
            obstacle.y = size - 140;
            obstacle.x = size - 170;
            stage.addChild(obstacle);

            //Start the game loop
            gameLoop();
        }

        function cloneMovingObjectProperties(object) {
            return {
                x: object.x,
                y: object.y,
                width: object.width,
                height: object.height
            };
        }

        function changeDirectionCausedByObstacle(point, obstacle) {
            var isHit = hitTestRectangle(point, obstacle);

            if (!isHit) {
                return;
            }

            // try if going back will cause to not to be overlapping
            var clone = cloneMovingObjectProperties(point);
            clone.x -= direction.x;
            if (hitTestRectangle(clone, object)) {
                // not overlapping anymore to so in x axis we go back 
                direction.x = -direction.x;
            } else {
                direction.y = -direction.y;
            }
        }

        function changeDirection(point) {
            if (point.x + point.width >= size) {
                point.vx = -point.vx;
            }

            if (point.x <= 0) {
                point.vx = -point.vx;
            }

            if (point.y + point.height >= size) {
                point.vy = -point.vy;
            }

            if (point.y <= 0) {
                point.vy = -point.vy;
            }
        }

        function gameLoop() {

            //Loop this function 60 times per second
            requestAnimationFrame(gameLoop);

            cat.x += cat.vx;
            cat.y += cat.vy;

            //changeDirectionCausedByObstacle(cat, obstacle);
            // Obstacle must be resolved first
            changeDirection(cat);

            var boom = hitTestRectangle(cat, door);
            if (boom) {
                alert("boom");

                cat.vx = -cat.vx;
                cat.vy = -cat.vy;
            }
            //Render the stage
            renderer.render(stage);
        }

        function testObstacleCollistion() {
            var object = {
                x: 0,
                y: 0,
                width: 10,
                height: 10
            }

            var obstacle = {
                x: 15,
                y: 0,
                width: 10,
                height: 10
            }
        }

        testObstacleCollistion();
    </script>
</body>
